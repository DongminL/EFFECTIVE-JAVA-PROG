# Item 70. 복구할 수 있는 상황에는 검사 예외를, 프로그래밍 오류에는 런타임 예외를 사용하라

## 검사 예외

자바는 **문제 상황을 알리는 타입**(`throwable`)으로 **검사 예외**, **런타인 예외**, **에러** 이렇게 세 가지를 제공한다.

먼저, **호출하는 쪽에서 복구할 수 있는 상황이라면 검사 예외를 사용하자**.

검사 예외를 던지면 호출자가 그 예외를 `catch`로 잡아  처리하거나 더 바깥으로 전파하도록 강제하게 된다. 따라서 **메서드 선언에 포함된 검사 예외 각각은 그 메서드를 호출했을 때 발생할 수 있는 유력한 결과임을 API 사용자에게 알려주는 것**이다.

> 검사 예외는 `Exception`의 하위 클래스 중 `RuntimeException`을 상속하지 않은 예외로 구현된다.

> 예) `FileNotFoundException` (존재하지 않는 파일 이름을 입력), `DataFormatException` (입력한 데이터 형식이 잘못됨)

<br>

## 런타임 예외

비검사 `throwable`은 두 가지로, **런타임 예외**와 **에러**이다. **프로그램에서 비검사 예외나 에러를 던졌다**는 것은 **복구가 불가능**하거나 **더 실행해봐야 득보다 실이 더 많다는 것**이다.

**프로그래밍 오류를 나타낼 때는 런타임 예외를 사용하자**. **런타임 예외의 대부분은 전제조건을 만족하지 못했을 때 발생**한다. 전제조건 위배는 단순히 사용자가 해당 API의 명세에 기록된 제약을 지키지 못했다는 뜻이다.

### 예시 - ArrayIndexOutOfBoundsException
---

`ArrayIndexOutOfBoundsException`는 "배열의 인덱스 범위는 0 ~ (배열 크기 - 1)이다."라는 전제조건을 지켜지지 않았다는 뜻이다.

### 애매한 경우에는 API 설계자의 판단
---

복구할 수 있는 상황인지, 프로그래밍 오류인지가 항상 명확히 구분되지는 않는다.

예를 들어 자원 고갈은 과도하게 큰 크기의 배열을 할당해 생긴 프로그래밍 오류일 수도 있고, 진짜로 자원이 부족해서 발생한 문제일 수 있다. 또한 자원이 일시적으로만 부족한 경우라면 충분히 복구할 수 있는 상황일 것이다. 

이렇게 해당 자원 고갈 상황이 **복구될 수 있는 것인지는 API 설계자의 판단**에 달렸다. **복구 가능하다고 판단했다면 검사 예외를, 그렇지 않다면 런타임 예외를 사용하자**. **확신하기 어려울 때는 보통 비검사 예외를 선택하는 편이 나을 것**이다.

<br>

## 에러

**에러**는 **보통 JVM이 자원 부족, 불변식 깨짐 등 더 이상 수행을 계속할 수 없는 상황을 나타낼 때 사용**한다.

그러나 검사 예외나 런타임 예외처럼 **`Error` 클래스를 상속해 하위 클래스를 만드는 일은 자제**해야 한다. 이는 자바 언언 명세가 요구하는 것은 아니지만, 업계에 널리 퍼진 규약이기 때문이다. 다시 말해서, **우리가 구현하는 비검사 `throwable`은 모두 `RuntimeException`의 하위 클래스여야 한다**. **`Error`는 상속하지 말아야 할 뿐 아니라, `throw` 문으로 직접 던지는 일도 없어야 한다. (`AssertionError`는 예외다.)**

<br>

## throwable에 관한 주의 사항

`Exception`, `RuntimeException`, `Error`를 상속하지 않는 `throwable`을 만들 수도 있다. 이 `throwable`은 암묵적으로 일반적인 검사 예외처럼 다룬다.

그러나 **이런 `throwable`은 이로울 게 없으니 절대로 사용하지 말자! `throwable`은 정상적인 검사 예외보다 나을 게 하나도 없으면서 API 사용자를 헷갈리게 할 뿐**이다.

<br>

## 예외 상황에 대한 정보

**예외의 메서드는 주로 그 예외를 일으킨 상황에 관한 정보를 코드 형태로 전달**하는 데 쓰인다. **`throwable` 클래스들은 대부분 오류 메시지 포맷을 상세히 기술하지 않는데, 이는 JVM이나 릴리스에 따라 포맷이 달라질 수 있다는 뜻**이다. 따라서 **메시지 문자열을 파싱해 얻은 코드는 깨지기 쉽고 다른 환경에서 동작하지 않을 수 있다**.

검사 예외는 일반적으로 복구할 수 있는 조건일 때 발생한다. 그렇기 때문에 **호출자가 예외 상황에서 벗어나는 데 필요한 정보를 알려주는 메서드를 함께 제공하는 것이 중요**하다.

<br>

## 정리

- 복구할 수 있는 상황이면 검사 예외를 던지자.

- 프로그래밍 오류라면 비검사 예외를 던지자.

- 확실하지 않다면 비검사 예외를 던지자.
