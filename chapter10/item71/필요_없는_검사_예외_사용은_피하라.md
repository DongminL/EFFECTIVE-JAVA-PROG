# Item 71. 필요 없는 검사 예외 사용은 피하라

## 검사 예외의 이점

검사 예외를 제대로 활용하면 API와 프로그램의 질을 높일 수 있다.

검사 예외는 **발생한 문제를 프로그래머가 처리하여 안전성을 높이게끔** 해준다.

## 검사 예외를 남용하지 말자

물론, **검사 예외를 과하게 사용하면 오히려 쓰기 불편한 API**가 된다.

어떤 메서드가 검사 예외를 던질 수 있다고 선언됐다면, 이를 호출하는 코드에서는 `catch` 블록을 두어 그 예외를 붙잡아 처리하거나 더 바깥으로 던져 문제를 전파해야만 한다. 이렇게 **어느 방법이든 API 사용자에게 부담**을 준다.

또한 **검사 예외를 던지는 메서드는 스트림 안에서 직접 사용할 수 없기** 때문에 자바 8부터는 부담이 더욱 커졌다.

<br>

## 예외를 처리할 사용자를 생각하며 예외를 선택하자

**API를 제대로 사용해도 발생할 수 있는 예외**이거나, **프로그래머가 의미 있는 조치를 취할 수 있는 경우**라면 이 정도 부담쯤은 받아들일 수 있을 것이다. 그러나 **둘 중 어디에도 해당하지 않는다면 비검사 예외를 사용**하는 것이 좋다.

**검사 예외와 비검사 예외 중 어느 것을 선택해야 할지는 프로그래머가 그 예외를 어떻게 다룰지 생각해보면 알 수 있다**.

``` java
try {
    ...
} catch (TheCheckedException e) {
    throw new AssertionError(); // 일어날 수 없다! (굳이 검사 예외를 발생시키지 않아도 됨)
}
```

``` java
try {
    ...
} catch (TheCheckedException e) {
    e.printStackTrace();
    System.exit(1); // 비검사 예외로 프로그램을 종료시킬 수 있음
}
```

더 나은 방법이 없다면 비검사 예외를 선택하자.

<br>

## 하나의 검사 예외만 던진다면 다시 생각해보자

**검사 예외가 프로그래머에게 주는 부담은 메서드가 단 하나의 검사 예외만 던질 때가 특히 크다**. 

이미 다른 예외도 던지는 상황이라면, `catch` 문 하나를 추가하기만 하면 된다. 그러나 **검사 예외가 단 하나뿐이라면 오직 그 예외 때문에 API 사용자는 `try` 블록을 추가해야 하고 스트림에서 직접 사용하지 못하게 된다**.

이런 상황이라면 검사 예외를 안 던지는 방법이 없는지 생각해볼 가치가 있다.

### 옵셔널로 검사 예외 회피하기
---

검사 예외를 회피하는 가장 쉬운 방법은 적절한 결과 타입을 담은 옵셔널을 반환하는 것이다. 검사 예외를 던지는 대신 단순한 빈 옵셔널을 반환하면 된다.

**이 방식의 단점**은 **예외가 발생한 이유를 알려주는 부가 정보를 담을 수 없다**는 것이다. 

### 메서드를 2개로 쪼개 회피하기

다른 방법으로, **검사 예외를 던지는 메서드를 2개로 쪼개 비검사 예외로 바꾸는 방법**이 있다.

**첫 번째 메서드는 예외가 던져질지 여부를 `boolean`값으로 반환한다**.

#### 예시 코드

``` java
// 코드 71-1 검사 예외를 던지는 메서드 - 리팩터링 전
try {
    obj.action(args);
} catch (TheCheckedException e) {
    ... // 예외 상황에 대처한다.
}
```

``` java
// 코드 71-2 상태 검사 메서드와 비검사 예외를 던지는 메서드 - 리팩터링 후
if (obj.actionPermitted(args)) {
    obj.action(args);
} else {
    ... // 예외 상황에 대처한다.
}
```

이 리팩터링을 모든 상황에 적용할 수는 없다. 그래도 적용할 수 만 있다면 더 쓰기 편한 API를 제공할 수 있다.

만약 프로그래머가 이 메서드가 성공하리라는 걸 안다거나, 실패 시 스레드를 중단하길 원한다면 다음처럼 한 줄로 작성해도 무방하다.

``` java
obj.action(args);
```

이 한 줄짜리 호출 방식이 주로 쓰일 거로 판단되면 리팩터링하는 편이 바람직하다.

`actionPermitted`는 **상태 검사 메서드이므로 주의**해야 한다. 즉, **외부 동기화 없이 여러 스레드가 동시에 접근할 수 있거나 외부 요인에 의해 상태가 변할 수 있다면 이 리팩터링은 적절하지 않다**.

<br>

## 정리

- 꼭 필요한 곳에만 사용한다면 검사 예외는 프로그램의 안전성을 높여주지만, 남용하면 쓰기 고통스러운 API를 낳는다.

- 복구할 방법이 없다면 비검사 예외를 던지자.

- 옵셔널만으로는 상황을 처리하기에 충분한 정보를 제공할 수 없을 때만 검사 예외를 사용하자.
