# Item 75. 예외의 상세 메시지에 실패 관련 정보를 담으라

## 예외를 잡지 못해 프로그램이 실패 시

**예외를 잡지 못해 프로그램이 실패하면, 자바 시스템은 그 예외의 스택 추적 정보를 자동을 출력**한다. **스택 추적은 예외 객체의 `toString()` 메서드가 붙는 형태**다. 이 정보가 실패 원인을 분석하기 위한 유일한 정보인 경우가 많다. 실패를 재현하기 어렵다면 더 자세한 정보를 얻기가 어렵거나 불가능하다.

따라서 **예외의 `toString()` 메서드에 실패 원인에 관한 정보를 가능한 많이 받아 반환하는 일은 매우 중요**하다. 사후 분석을 위해 실패 순간의 상황을 정확히 포착해 예외의 상세 메시지에 담아야 한다.

<br>

## 실패 순간 포착 방법

**실패 순간을 포착하려면 발생한 예외에 관여된 모든 매개변수와 필드의 값을 실패 메시지에 담아야 한다**.

#### 예시 - IndexOutOfBoundsException

`IndexOutOfBoundsException`가 발생할 수 있는 상황은 다음과 같다.

1. 인덱스가 최소값보다 작은 경우

2. 인덱스가 최대값보다 같거나 클 경우 (인덱스는 0부터 시작하기 때문에 최대값과 같으면 안됨)

3. 최소값이 최대값보다 클 경우 (내부의 불변식이 심각히 깨진 경우)

이렇게 하나의 예외에서 3 가지의 원인이 나올 수 있다. 따라서 **예외가 발생한 현상을 보면 무엇을 고쳐야 할지를 분석하는 데 큰 도움**이 된다.

### 관련 데이터가 과할 필요는 없다
---

**관련 데이터를 모두 담아야 하지만 너무 과할 필요는 없다**. 문제를 분석하는 사람은 스택 추적뿐 아니라 관련 문서와 소스코드를 함께 살펴볼 수 있다. 또한 스택 추적에는 예외가 발생한 파일명과 줄번호까지 정확히 기록되어 있다. 문서와 소스코드에서 얻을 수 있는 정보는 길게 늘어놔봐야 군더더기가 될 뿐이다.

또한 **보안과 관련된 정보는 주의**해서 다뤄야 한다. 스택 추적 정보는 많은 사람들이 볼 수 있기 때문에 **상세 메시지에 비밀번호나 암호 키 같은 정보까지는 담아서는 안 된다**.

### 예외 메시지의 타겟층을 혼동하지 말자
---

**예외의 상세 메시지와 최종 사용자에게 보여줄 오류 메시지를 혼동해서는 안 된다**. 최종 사용자에게는 친절한 안내 메시지를 보여줘야 하지만, **에외의 상세 메시지는 가독성보다는 담긴 내용이 훨씬 중요**하다.

### 예외 생성자에서 관련 정보 받기
---

실패를 적절하게 포착하기 위해서 **필요한 정보를 예외 생성자에서 모두 받아서 상세 메시지까지 미리 생성해놓는 방법**도 괜찮다.

기존의 `IndexOutOfBoundsException` 생성자는 `String`을 받지만, 아래와 같이 변경해도 좋을 것 같다.

``` java
// 실패 상황을 온전히 포착하도록 수정해본 IndexOutOfBoundsException (405쪽)
public class IndexOutOfBoundsException extends RuntimeException {
    private final int lowerBound;
    private final int upperBound;
    private final int index;

    /**
     * IndexOutOfBoundsException을 생성한다.
     *
     * @param lowerBound 인덱스의 최솟값
     * @param upperBound 인덱스의 최댓값 + 1
     * @param index      인덱스의 실젯값
     */
    public IndexOutOfBoundsException(int lowerBound, int upperBound,
                                     int index) {
        // 실패를 포착하는 상세 메시지를 생성한다.
        super(String.format(
                "최솟값: %d, 최댓값: %d, 인덱스: %d",
                lowerBound, upperBound, index));

        // 프로그램에서 이용할 수 있도록 실패 정보를 저장해둔다.
        this.lowerBound = lowerBound;
        this.upperBound = upperBound;
        this.index = index;
    }
}
```

자바 라이브러리에서는 이 조언을 적극 수용하지는 않지만, 저자는 강력히 권장한다. 이렇게 하면 **프로그래머가 던지는 예외는 자연스럽게 실패를 잘 포착**한다. 또한 **고품질의 상세 메시지를 만들어내는 코드를 예외 클래스 안으로 모아주는 효과**도 있어, **클래스 사용자가 메시지를 만드는 작업을 중복하지 않아**도 된다.

### 실패 관련 Getter 제공하기
---

**예외는 실패와 관련한 정보를 얻을 수 있는 `Getter`를 적절히 제공하는 것이 좋다**. 앞에 예시에서는 `lowerBound`와 `upperBound`, `index` 정도가 적당하다.

포착한 실패 정보는 예외 상황을 복구하는 데 유용할 수 있다. `Getter`는 비검사 예외보다는 검사 예외에서 더 빛을 바란다. '`toString()`이 반환한 값에 포함된 정보를 얻어올 수 있는 API를 제공하자'하는 일반 원칙을 따른다는 관점에서, 비검사 예외라도 상세 정보를 알려주는 `Getter`를 제공하라고 권한다.
