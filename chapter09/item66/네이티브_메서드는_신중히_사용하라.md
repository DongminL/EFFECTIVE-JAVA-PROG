# Item 66. 네이티브 메서드는 신중히 사용하라

## 네이티브 메서드란

**네이티브 메서드**는 **C나 C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드**를 말한다.

### 네이티브 메서드의 특징
---

- 레지스트리 같은 플랫폼 특화 기능을 사용한다.

- 네이티브 코드로 작성된 기존 라이브러리를 사용한다.

- 성능 개선 목적으로 성능에 결정적인 영향을 주는 영역만 따로 네이티브 언어로 작성한다.

<br>

## 성능 개선 목적은 권장하지 않는다

하지만 **자바가 발전하면서 OS 같은 하부 플랫폼의 기능들을 점차 흡수**하고 있다. 그래서 **네이티브 메서드를 사용할 필요가 계속 줄어**들고 있다.

자바 초기 시절(자바 3 이전)이라면 성능 개선 목적으로 네이티브 메서드를 사용하는 것을 권장을 한다. 

그렇지만 JVM은 그동안 엄청난 속도로 발전해왔고, 대부분 작업에서 **지금의 자바는 다른 플랫폼에 견줄만한 성능**을 보인다.

### 사례 - BigInteger의 네이티브 메서드 사용의 변화
---

자바 1.1 시절 `BigInteger`는 C로 작성한 고성능 라이브러리에 의지했다.

이후 자바 3 때 순수 자바로 다시 구현되면서 세심히 튜닝한 결과, 원래의 네이티브 구현보다도 더 빨라졌다.

### 다중 정밀 연산이 필요할 때는 고려해보자
---

네이티브 라이브러리 쪽은 GNU 다중 정밀 연산 라이브러리(GMP)를 필두로 개선 작업이 계속 되어왔다.

고성능의 다중 정밀 연산이 필요한 자바 프로그래머라면, 이제 네이티브 메서드를 통해 GMP를 사용하는 것을 고려해도 좋다.

<br>

## 네이티브의 심각한 단점

- 네이티브 언어가 안전하지 않으므로 네이티브 메서드를 사용하는 애플리케이션도 **메모리 훼손 오류로부터 안전하지 않다**.

- 자바보다 플랫폼에 영향을 많이 받아 **이식성도 낮다**.

- **디버깅도 어렵다**.

- 주의하지 않으면 **속도가 오히려 느려**질 수 있다.

- **가비지 컬렉터가 네이티브 메모리는 자동 회수하지 못하고, 심지어 추적조차 할 수 없다**.

- **자바 코드와 네이티브 코드의 경계를 넘나들 때마다 비용도 추가**된다.

- 네이티브 메서드와 자바 코드 사이의 '접착 코드(glue code)'를 작성해야 하는데, 이는 **귀찮고 가독성도 떨어진다**.

<br>

## 정리

- 네이티브 메서드가 성능을 개선해주는 일은 많지 않다.

- 저수준 자원이나 네이티브 라이브러리를 사용해야만 해서 어쩔 수 없더라도 네이티브 코드는 최소한만 사용하고 철저히 테스트하자.
